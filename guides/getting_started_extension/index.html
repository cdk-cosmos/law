<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.61">
<title data-react-helmet="true">Getting Started with Extensions | Cdk Cosmos Law</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Getting Started with Extensions | Cdk Cosmos Law"><meta data-react-helmet="true" name="description" content="CDK Cosmos provides high level resources in the core that can be shared among your various apps, in order to minimise cost and maximise efficiency. These core resources are consumed through a Cosmos concept known as the Portal. The Portal gives access to the cluster and listeners/ALB from the core in a decoupled import/export pattern to use in ECS."><meta data-react-helmet="true" property="og:description" content="CDK Cosmos provides high level resources in the core that can be shared among your various apps, in order to minimise cost and maximise efficiency. These core resources are consumed through a Cosmos concept known as the Portal. The Portal gives access to the cluster and listeners/ALB from the core in a decoupled import/export pattern to use in ECS."><meta data-react-helmet="true" property="og:url" content="https://cdk-cosmos.github.io//law/guides/getting_started_extension"><link data-react-helmet="true" rel="shortcut icon" href="/law/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cdk-cosmos.github.io//law/guides/getting_started_extension"><link rel="stylesheet" href="/law/styles.6eaf09fd.css">
<link rel="preload" href="/law/styles.e4c59df8.js" as="script">
<link rel="preload" href="/law/runtime~main.86f6e787.js" as="script">
<link rel="preload" href="/law/main.3bdcd07c.js" as="script">
<link rel="preload" href="/law/1.8571fb6d.js" as="script">
<link rel="preload" href="/law/2.2961cee2.js" as="script">
<link rel="preload" href="/law/236.315ef293.js" as="script">
<link rel="preload" href="/law/237.a932438a.js" as="script">
<link rel="preload" href="/law/284db4bf.4c9bf30e.js" as="script">
<link rel="preload" href="/law/17896441.15f9fc3d.js" as="script">
<link rel="preload" href="/law/3d4a4df4.d7c96908.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/law/"><img class="navbar__logo" src="/law/img/cdk-cosmos-crop.png" alt="Cdk Cosmos"><strong class="navbar__title">Cdk Cosmos</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/law/guides/">Guides</a><a class="navbar__item navbar__link" href="/law/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/cdk-cosmos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/law/"><img class="navbar__logo" src="/law/img/cdk-cosmos-crop.png" alt="Cdk Cosmos"><strong class="navbar__title">Cdk Cosmos</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/law/guides/">Guides</a></li><li class="menu__list-item"><a class="menu__link" href="/law/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/cdk-cosmos" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/law/guides/">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/law/guides/getting_started_bootstrap">Bootstrapper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/law/guides/getting_started_core">Core</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/law/guides/getting_started_extension">Extensions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/law/guides/getting_started_app">Hello World App</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Template Building</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/law/guides/templates_intro">Building Your Own Templates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/law/guides/templates_ecr">ECR Template</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/law/guides/templates_lambda">Lambda Template</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Getting Started with Extensions</h1></header><div class="markdown"><p>CDK Cosmos provides high level resources in the core that can be shared among your various apps, in order to minimise cost and maximise efficiency. These core resources are consumed through a Cosmos concept known as the Portal. The Portal gives access to the cluster and listeners/ALB from the core in a decoupled import/export pattern to use in ECS.</p><p>This import/export pattern is the main benefit of CDK Cosmos, as although extensions are dependent on the core, they are kept separate from one another despite existing in the same AWS account. This means that an error or deleted stack in one extension won&#x27;t have any effect on other extensions sharing the same Cosmos core.</p><p>This has all been patternised in CDK Cosmos. To use the portal to target a specific account to add or deploy resources into those galaxies/solar systems, you simply need to align to the naming scheme in the core across your extensions. E.g. <code>new AppGalaxyStack(cosmos, &#x27;Mgt&#x27;)</code> must use <strong>Mgt</strong> in both core and extensions. Cosmos will do the rest!</p><blockquote><p>Note: You will need to have a Cosmos Core in your management account before you deploy an extension. You will also need to have a solar system set up to you have access to thosee resources for your extension.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="edit-the-extension-template"></a>Edit the Extension Template<a aria-hidden="true" tabindex="-1" class="hash-link" href="#edit-the-extension-template" title="Direct link to heading">#</a></h3><p>Bootstrapping an extension is similar to setting up your core Cosmos. Again, the easiest way to get started with an extension is to clone a template to your local machine and run <code>npm install</code>. <strong>To avoid errors, make sure you are running the same package versions as Core Cosmos.</strong></p><ul><li><a href="https://github.com/cdk-cosmos/cosmos-extension-cdk" target="_blank" rel="noopener noreferrer">Cosmos ECS Extension Template</a>: used in this guide</li><li><a href="https://github.com/cdk-cosmos/cosmos-blank-extension-cdk" target="_blank" rel="noopener noreferrer">Cosmos Blank Extension Template</a>: used to build out different types of extensions</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="bootstrap-an-extension"></a>Bootstrap an Extension<a aria-hidden="true" tabindex="-1" class="hash-link" href="#bootstrap-an-extension" title="Direct link to heading">#</a></h3><p>As with core cosmos, fill out <code>bin/main.ts</code> with your account configuration and app name. Then, simply export your AWS CLI master account credentials in the terminal and run the below command. You will need to be using an IAM role with (operator permissions)).</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">npx cdk --app &quot;node_modules/@cosmos-building-blocks/common/lib/cdk-toolkit/bootstrap-app.js&quot; deploy</span></div></div></div></div></div><blockquote><p>As with core, if you hit <a href="https://github.com/cdk-cosmos/cosmos/issues/304" target="_blank" rel="noopener noreferrer">issue #304</a> where this step doesn&#x27;t deploy the resources needed, use STACKS=&quot;--all&quot; npx cdk --app &quot;node_modules/@cosmos-building-blocks/common/lib/cdk-toolkit/bootstrap-app.js&quot; deploy </p></blockquote><p>This will archive this Extension and pass it as an asset to the Cosmos CDK Toolkit s3 bucket in your master account, and trigger the CodeBuild job to bootstrap your Extension. You can watch the CodeBuild project logs (cdk-toolkit-bootstrap-project) and CloudFormation to see what resources are being created.</p><p>A CodeCommit repository to house this newly customised Extension was created as part of the bootstrapping process above. Update the git repository in this Extension to point to the new CodeCommit respository. Replacing the <strong>your-region</strong> section with the region you selected in Step 3 and the <strong>your-app</strong> section with the name you gave your project in <code>bin/main.ts </code>, run the following command:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git remote set-url origin &quot;https://git-codecommit.your-region.amazonaws.com/v1/repos/app-your-app-cdk-repo&quot;</span></div></div></div></div></div><p>You can also find the repository url in CodeCommit. Then:</p><ul><li>Add the changes made to this template by running <code>git add .</code></li><li>Commit the changes by running <code>git commit -m &quot;inital commit&quot;</code> </li><li>Push the changes to CodeCommit by running <code>git push</code></li></ul><p>Your Extension now has a CDK &amp; Code Pipeline. Any further changes may be deployed using the Extension&#x27;s own CDK Pipeline.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="solar-systems"></a>Solar Systems<a aria-hidden="true" tabindex="-1" class="hash-link" href="#solar-systems" title="Direct link to heading">#</a></h3><p>As with core, the Solar Systems need to be deployed after bootstrapping as they are dependent on Cosmos and Galaxy resources created on the initial run of the pipeline. To deploy, uncomment the solar system, push up your changes and re-run the App CDK pipeline. </p><blockquote><p>If you get an error &#x27;AppDemoDevDevSolarSystem failed: Error [ValidationError]: Unable to fetch parameters [/App/Demo/Dev/Dev/VersionState] from parameter store for this account.&#x27; when running the cdk pipeline to add the solar systems, run the code pipeline first.</p></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="deploy-stages"></a>Deploy Stages<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploy-stages" title="Direct link to heading">#</a></h4><p>This template includes a separate deploy stage in the code pipeline for each new solar system. The below code would deploy the <code>dev</code> and <code>tst</code> stacks.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ciCd.addCdkDeployEnvStageToCodePipeline({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: &#x27;DeployDev&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    stacks: [dev, tst],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div></div></div><p>This is optional. The template includes a final deploy stage that will deploy all stacks, however, separating out stacks allows you to retry sections - for example, you may wish to run the dev stack to test your changes before approving a roll out to prod. It is also recommended to include a CiCd stage at the start of the pipeline, to minimise additional runs of the pipeline. You can add stages to both the Code pipeline (<code>ciCd.addCdkDeployEnvStageToCodePipeline</code>) and the CDK pipeline (<code>ciCd.addCdkDeployEnvStageToCdkPipeline</code>) for your extension, if you have defined those functions in <code>lib/ci-cd-solar-system.ts</code>. See (cosmos-blank-extension-cdk)[https://github.com/cdk-cosmos/cosmos-blank-extension-cdk/blob/master/lib/ci-cd-solar-system.ts] for an example of this if your template does not include it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="next-steps"></a>Next Steps<a aria-hidden="true" tabindex="-1" class="hash-link" href="#next-steps" title="Direct link to heading">#</a></h3><p>Once you&#x27;ve bootstrapped your Cosmos extension, you can continue on to deploy a sample Hello World app.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="next-step-deploying-cosmos-app"></a><a href="/law/guides/getting_started_app">Next Step: Deploying Cosmos App</a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#next-step-deploying-cosmos-app" title="Direct link to heading">#</a></h2></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/cdk-cosmos/law/edit/master/guides/getting_started_extension.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/law/guides/getting_started_core"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Getting Started with the Core</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/law/guides/getting_started_app"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Getting Started - Hello World App Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#edit-the-extension-template" class="table-of-contents__link">Edit the Extension Template</a></li><li><a href="#bootstrap-an-extension" class="table-of-contents__link">Bootstrap an Extension</a></li><li><a href="#solar-systems" class="table-of-contents__link">Solar Systems</a></li><li><a href="#next-steps" class="table-of-contents__link">Next Steps</a></li><li><a href="#next-step-deploying-cosmos-app" class="table-of-contents__link">Next Step: Deploying Cosmos App</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2021 cdk-cosmos. Built with Docusaurus.</div></div></div></footer></div>
<script src="/law/styles.e4c59df8.js"></script>
<script src="/law/runtime~main.86f6e787.js"></script>
<script src="/law/main.3bdcd07c.js"></script>
<script src="/law/1.8571fb6d.js"></script>
<script src="/law/2.2961cee2.js"></script>
<script src="/law/236.315ef293.js"></script>
<script src="/law/237.a932438a.js"></script>
<script src="/law/284db4bf.4c9bf30e.js"></script>
<script src="/law/17896441.15f9fc3d.js"></script>
<script src="/law/3d4a4df4.d7c96908.js"></script>
</body>
</html>