<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.61">
<title data-react-helmet="true">Getting Started with the Core | Cdk Cosmos Law</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Getting Started with the Core | Cdk Cosmos Law"><meta data-react-helmet="true" name="description" content="In the previous step, we bootstrapped the bootstrap code. This gave us IAM roles and a codebuild project, which we can now use to bootstrap Cosmos into the account defined in your lib/main.ts file."><meta data-react-helmet="true" property="og:description" content="In the previous step, we bootstrapped the bootstrap code. This gave us IAM roles and a codebuild project, which we can now use to bootstrap Cosmos into the account defined in your lib/main.ts file."><meta data-react-helmet="true" property="og:url" content="https://cdk-cosmos.github.io//law/guides/getting_started_core"><link data-react-helmet="true" rel="shortcut icon" href="/law/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cdk-cosmos.github.io//law/guides/getting_started_core"><link rel="stylesheet" href="/law/styles.6eaf09fd.css">
<link rel="preload" href="/law/styles.e4c59df8.js" as="script">
<link rel="preload" href="/law/runtime~main.86f6e787.js" as="script">
<link rel="preload" href="/law/main.3bdcd07c.js" as="script">
<link rel="preload" href="/law/1.8571fb6d.js" as="script">
<link rel="preload" href="/law/2.2961cee2.js" as="script">
<link rel="preload" href="/law/236.315ef293.js" as="script">
<link rel="preload" href="/law/237.a932438a.js" as="script">
<link rel="preload" href="/law/284db4bf.4c9bf30e.js" as="script">
<link rel="preload" href="/law/17896441.15f9fc3d.js" as="script">
<link rel="preload" href="/law/d9a606f1.0f76b61e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/law/"><img class="navbar__logo" src="/law/img/cdk-cosmos-crop.png" alt="Cdk Cosmos"><strong class="navbar__title">Cdk Cosmos</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/law/guides/">Guides</a><a class="navbar__item navbar__link" href="/law/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/cdk-cosmos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/law/"><img class="navbar__logo" src="/law/img/cdk-cosmos-crop.png" alt="Cdk Cosmos"><strong class="navbar__title">Cdk Cosmos</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/law/guides/">Guides</a></li><li class="menu__list-item"><a class="menu__link" href="/law/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/cdk-cosmos" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/law/guides/">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/law/guides/getting_started_bootstrap">Bootstrapper</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/law/guides/getting_started_core">Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/law/guides/getting_started_extension">Extensions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/law/guides/getting_started_app">Hello World App</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Template Building</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/law/guides/templates_intro">Building Your Own Templates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/law/guides/templates_ecr">ECR Template</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/law/guides/templates_lambda">Lambda Template</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Getting Started with the Core</h1></header><div class="markdown"><p>In the previous step, we bootstrapped the bootstrap code. This gave us IAM roles and a codebuild project, which we can now use to bootstrap Cosmos into the account defined in your lib/main.ts file.</p><p>In the previous step, we bootstrapped the bootstrap toolkit. This gave us IAM roles and a codebuild project, which we can now use to bootstrap Cosmos into the management account defined in your <code>lib/main.ts</code> file.</p><p>To bootstrap your Cosmos core, run the below command in the base directory of your project, with credentials for the master account exported.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">npx cdk --app &quot;node_modules/@cosmos-building-blocks/common/lib/cdk-toolkit/bootstrap-app.js&quot; deploy</span></div></div></div></div></div><p>This will archive your current working directory and pass it as an asset to the CDK Toolkit s3 bucket in your master account, and trigger the CodeBuild job to bootstrap your Cosmos core.</p><blockquote><p>There is a known issue with this step in some versions of CDK Cosmos, due to naming changes in later versions of AWS CDK. See <a href="https://github.com/cdk-cosmos/cosmos/issues/304" target="_blank" rel="noopener noreferrer">issue #304</a> for updates. If this step doesn&#x27;t deploy the resources needed (e.g. no new stacks are created), use STACKS=&quot;--all&quot; npx cdk --app &quot;node_modules/@cosmos-building-blocks/common/lib/cdk-toolkit/bootstrap-app.js&quot; deploy </p></blockquote><p>A CodeCommit repository to house this newly customised Core was created as part of the bootstrapping process above. You should now update your local repository to point to the new CodeCommit repository. Replacing the <em>your-region</em> section with the region you selected in <code>bin/main.ts</code>, run the following command:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">git remote set-url origin &quot;https://git-codecommit.your-region.amazonaws.com/v1/repos/core-cdk-repo&quot;</span></div></div></div></div></div><p>Add the changes made to this template by running <code>git add .</code>, commit the changes by running <code>git commit -m &quot;inital commit&quot;</code>, and push the changes to CodeCommit by running <code>git push</code> with your AWS master account credentials exported in the CLI.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="what-youll-get"></a>What you&#x27;ll get<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-youll-get" title="Direct link to heading">#</a></h3><p><em>Sample Pattern with Management, Development &amp; Production Accounts, with two Solar Systems in Dev (Dev &amp; Test):</em></p><p><img src="/law/assets/images/cosmos-core-bootstrap-566fb257eef7f87fafbfd5e8ce96cef4.png"></p><p><strong>Cosmos Resources</strong></p><ul><li>TLD (top level domain), e.g. demo.site.com</li><li>Master role that creates resources and can assume cross-account roles to create resources in those accounts</li><li>Pipeline to deploy new resources if needed (<em>Core-DemoApp-Cdk-Pipeline</em>)</li></ul><p><strong>Galaxy Resources</strong></p><ul><li>Cross-account role that master can assume </li><li>Shared KMS encrytion key, can be used by solar systems to encrypt things</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="solar-systems"></a>Solar systems<a aria-hidden="true" tabindex="-1" class="hash-link" href="#solar-systems" title="Direct link to heading">#</a></h3><p>On the first run of the pipeline, solar systems are commented out in <code>bin/main.ts</code>. This is to avoid dependency issues, as the solar systems rely on resources that are created on the first run through of the pipeline. When you uncomment the solar system and run the pipeline, it will create a new deploy stage in the pipeline to deploy to the new environment if you have something like the below code (provided by default).</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Add NON-PRD deploy stage</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ciCd.ciCd?.addDeployStackStage({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: &quot;DeployNonPrd&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    stacks: [dev],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div></div></div><p>CDK Cosmos is currently using AWS Code Pipelines, which will pause and need to be re-run when a change is made to the pipeline itself. A way to minimise pipeline runs is to add a CiCd stage to your pipeline, which will deploy the changes to CiCd early on instead of waiting until the final deploy stage.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Add CiCd deploy stage</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ciCd.ciCd?.addDeployStackStage({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: &quot;DeployCiCd&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    stacks: [ciCd],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    isManualApprovalRequired: false,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div></div></div><p>You can also achieve the same effect with a more manual step, by starting the build projects with an override to deploy only the CiCd stack. You will need to set stack to <code>-e *CiCd*</code> (for earlier versions of Cosmos) or the full name of the CiCd stack if using a later (AWS CDK 1.104+ won&#x27;t accept wildcard naming).</p><p>Future versions of CDK Cosmos may switch to using the new CDK Pipeline construct, which is self-mutating, and will remove some of the duplicate runs of the pipeline.</p><blockquote><p>If using a version of CDK Cosmos that is below 0.8.12, using certs in your solar system may require going into AWS Certificate manager to create a route 53 record. That is outside the scope of this guide - it is recommended to use the latest version of CDK Cosmos to access the latest features and bug fixes.</p></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="what-you-have-now"></a>What you have now<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-you-have-now" title="Direct link to heading">#</a></h4><p>Solar system in each environment defined in <code>bin/main.ts</code></p><ul><li>vpc and subdomain (e.g. dev, tst, prd from tld)</li><li>certificates (optional)</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="next-steps"></a>Next Steps<a aria-hidden="true" tabindex="-1" class="hash-link" href="#next-steps" title="Direct link to heading">#</a></h3><p>Once you&#x27;ve bootstrapped your Cosmos core, you can use these resources within extensions to build out your apps.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="next-step-deploying-cosmos-extension"></a><a href="/law/guides/getting_started_extension">Next Step: Deploying Cosmos Extension</a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#next-step-deploying-cosmos-extension" title="Direct link to heading">#</a></h2></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/cdk-cosmos/law/edit/master/guides/getting_started_core.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/law/guides/getting_started_bootstrap"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Getting Started - Bootstrapping</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/law/guides/getting_started_extension"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Getting Started with Extensions Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-youll-get" class="table-of-contents__link">What you&#39;ll get</a></li><li><a href="#solar-systems" class="table-of-contents__link">Solar systems</a></li><li><a href="#next-steps" class="table-of-contents__link">Next Steps</a></li><li><a href="#next-step-deploying-cosmos-extension" class="table-of-contents__link">Next Step: Deploying Cosmos Extension</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2021 cdk-cosmos. Built with Docusaurus.</div></div></div></footer></div>
<script src="/law/styles.e4c59df8.js"></script>
<script src="/law/runtime~main.86f6e787.js"></script>
<script src="/law/main.3bdcd07c.js"></script>
<script src="/law/1.8571fb6d.js"></script>
<script src="/law/2.2961cee2.js"></script>
<script src="/law/236.315ef293.js"></script>
<script src="/law/237.a932438a.js"></script>
<script src="/law/284db4bf.4c9bf30e.js"></script>
<script src="/law/17896441.15f9fc3d.js"></script>
<script src="/law/d9a606f1.0f76b61e.js"></script>
</body>
</html>