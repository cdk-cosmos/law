<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.61">
<title data-react-helmet="true">Getting Started - Bootstrapping | Cdk Cosmos Law</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Getting Started - Bootstrapping | Cdk Cosmos Law"><meta data-react-helmet="true" name="description" content="The bootstrapper is a package included in Cosmos Core building blocks that extends the AWS CDK toolkit with additional functionality to make deploying a Cosmos core or extension easier. The Cosmos CDK Toolkit includes, in addition to an s3 bucket for staging assets, a CodeBuild project that deploys your CDK. Because this deploy project runs in AWS as opposed to on your local workstation, the necessary roles are already configured for you."><meta data-react-helmet="true" property="og:description" content="The bootstrapper is a package included in Cosmos Core building blocks that extends the AWS CDK toolkit with additional functionality to make deploying a Cosmos core or extension easier. The Cosmos CDK Toolkit includes, in addition to an s3 bucket for staging assets, a CodeBuild project that deploys your CDK. Because this deploy project runs in AWS as opposed to on your local workstation, the necessary roles are already configured for you."><meta data-react-helmet="true" property="og:url" content="https://cdk-cosmos.github.io//law/guides/getting_started_bootstrap"><link data-react-helmet="true" rel="shortcut icon" href="/law/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cdk-cosmos.github.io//law/guides/getting_started_bootstrap"><link rel="stylesheet" href="/law/styles.6eaf09fd.css">
<link rel="preload" href="/law/styles.e53de1f6.js" as="script">
<link rel="preload" href="/law/runtime~main.1f7a4256.js" as="script">
<link rel="preload" href="/law/main.2385d690.js" as="script">
<link rel="preload" href="/law/1.9bb5bc63.js" as="script">
<link rel="preload" href="/law/2.2caee38a.js" as="script">
<link rel="preload" href="/law/233.41b00121.js" as="script">
<link rel="preload" href="/law/234.c6250b1e.js" as="script">
<link rel="preload" href="/law/284db4bf.58509f41.js" as="script">
<link rel="preload" href="/law/17896441.bafc05a4.js" as="script">
<link rel="preload" href="/law/89d34995.892c5684.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/law/"><img class="navbar__logo" src="/law/img/logo.svg" alt="Cdk Cosmos"><strong class="navbar__title">Cdk Cosmos</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/law/guides/">Guides</a><a class="navbar__item navbar__link" href="/law/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/cdk-cosmos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/law/"><img class="navbar__logo" src="/law/img/logo.svg" alt="Cdk Cosmos"><strong class="navbar__title">Cdk Cosmos</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/law/guides/">Guides</a></li><li class="menu__list-item"><a class="menu__link" href="/law/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/cdk-cosmos" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/law/guides/">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Quickstart</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/law/guides/quickstart">Quickstart Guide</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/law/guides/getting_started_bootstrap">Bootstrapper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/law/guides/getting_started_core">Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/law/guides/getting_started_extension">Extensions</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Getting Started - Bootstrapping</h1></header><div class="markdown"><p>The bootstrapper is a package included in Cosmos Core building blocks that extends the AWS CDK toolkit with additional functionality to make deploying a Cosmos core or extension easier. The Cosmos CDK Toolkit includes, in addition to an s3 bucket for staging assets, a CodeBuild project that deploys your CDK. Because this deploy project runs in AWS as opposed to on your local workstation, the necessary roles are already configured for you.</p><p>The easiest way to get started with Cosmos is to use a template. Currently there are templates for the following patterns:</p><ul><li><a href="https://github.com/cdk-cosmos/cosmos-core-cdk" target="_blank" rel="noopener noreferrer">Cosmos Core CDK </a></li></ul><p>This template is flavoured for ECS and the walkthrough will deploy a Hello World node app. You will be able to edit or add more features once you have bootstrapped the initial project. Clone the template to your local machine and run <code>npm install</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="edit-binmaints"></a>Edit bin/main.ts<a aria-hidden="true" tabindex="-1" class="hash-link" href="#edit-binmaints" title="Direct link to heading">#</a></h3><p>This is where you will identify the accounts in the Cosmos pattern, e.g. mgt, dev, prod, and configure the needed resources.</p><ol><li>Complete the configuration objects with your account numbers and regions</li><li>Change the project name from <code>Demo</code> to the name of your Core</li><li>Replace the TLD (top level domain) with the correct one for your project</li><li>Add the appropriate CIDR ranges</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="bootstrap-the-bootstrapper"></a>Bootstrap the bootstrapper<a aria-hidden="true" tabindex="-1" class="hash-link" href="#bootstrap-the-bootstrapper" title="Direct link to heading">#</a></h3><p>At this point you have reached the minimal requirements to bootstrap your Cosmos Core. We don&#x27;t recommend adding any further resources until the bootstrapping process is complete. When bootstrapping the bootstrapper, you will need to be using an IAM role able to create and edit policies.</p><p>Deploying the Cosmos CDK Toolkit requires the following environment variables to be exported in your local environment:</p><ul><li><code>AWS_MASTER_ACCOUNT</code>: Your management account in a typical multi-account pattern.</li><li><code>AWS_ACCOUNT</code>: The account in which the Cosmos CDK Toolkit will be deployed. This may be the master account.</li></ul><p>For example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">export AWS_MASTER_ACCOUNT=11111111</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export AWS_ACCOUNT=22222222</span></div></div></div></div></div><p>Then use the below command to deploy the Cosmos CDK Toolkit resources to your environments.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">npx cdk bootstrap --template &quot;node_modules/@cosmos-building-blocks/common/lib/cdk-toolkit/template.yaml&quot; --cloudformation-execution-policies arn:aws:iam::aws:policy/AdministratorAccess --trust ${AWS_MASTER_ACCOUNT} aws://${AWS_ACCOUNT}/ap-southeast-2</span></div></div></div></div></div><ul><li><p><code>--template</code> substitutes the regular CDK Toolkit template with the Cosmos version</p></li><li><p><code>--cloudformation-execution-policies</code> attaches the required policy to the deployment role</p></li><li><p><code>--trust</code> defines the AWS account that may deploy into the environment being bootstrapped</p><blockquote><p>Important note for local development: if you get an error in this step, you may need to set <code>export CDK_COSMOS_CREDENTIALS_PLUGIN_DISABLE=true</code> (plugin assumes roles when in AWS, but when working locally you use your own credentials)</p></blockquote></li></ul><p>This command will need to be run once for each AWS account in your multi-account pattern, substituting the AWS_ACCOUNT environment variable each time to target each account. You will need to have the required credentials for each account either in your AWS CLI configuration or exported locally as environment variables.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="what-you-have-now"></a>What you have now<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-you-have-now" title="Direct link to heading">#</a></h4><p>This is the initial step required to deploy Cosmos into your AWS accounts. At this point, you will have a bootstrap Code Build project in your master account (s3 bucket), and a bootstrap IAM role in each account (including master). This role will be used to bootstrap your Cosmos core or extension. </p><p>Please note that these accounts are created outside of your Cosmos stacks, as they are used to deploy the stacks. Therefore, if you delete Cosmos stacks in future, these roles will remain in the accounts unless manually deleted.</p><p><em>Sample Pattern with Management, Development &amp; Production Accounts:</em></p><p><img src="/law/assets/images/cosmos-bootstrap-d96e577de2e54a038ed0132fbb6946c9.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="next-step-deploying-cosmos-core"></a><a href="/law/guides/getting_started_core">Next Step: Deploying Cosmos Core</a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#next-step-deploying-cosmos-core" title="Direct link to heading">#</a></h2><hr></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/cdk-cosmos/law/edit/master/guides/getting_started_bootstrap.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/law/guides/quickstart"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Quickstart - Bootstrap Cosmos Core</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/law/guides/getting_started_core"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Getting Started with the Core Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#edit-binmaints" class="table-of-contents__link">Edit bin/main.ts</a></li><li><a href="#bootstrap-the-bootstrapper" class="table-of-contents__link">Bootstrap the bootstrapper</a></li><li><a href="#next-step-deploying-cosmos-core" class="table-of-contents__link">Next Step: Deploying Cosmos Core</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2021 cdk-cosmos. Built with Docusaurus.</div></div></div></footer></div>
<script src="/law/styles.e53de1f6.js"></script>
<script src="/law/runtime~main.1f7a4256.js"></script>
<script src="/law/main.2385d690.js"></script>
<script src="/law/1.9bb5bc63.js"></script>
<script src="/law/2.2caee38a.js"></script>
<script src="/law/233.41b00121.js"></script>
<script src="/law/234.c6250b1e.js"></script>
<script src="/law/284db4bf.58509f41.js"></script>
<script src="/law/17896441.bafc05a4.js"></script>
<script src="/law/89d34995.892c5684.js"></script>
</body>
</html>